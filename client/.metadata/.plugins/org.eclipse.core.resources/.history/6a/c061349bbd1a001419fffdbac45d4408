package com.sina.finance.data
{

    public class HQ extends Object
    {
        public var buy:Number;
        public var name:String;
        private var _bufData:Object;
        public var symbol:String;
        public var avg_price:Number = 0;
        public var isPre25Min:Boolean;
        public var volume:Number = 0;
        public var high:Number;
        public var prevclose:Number;
        private var _isShIndexOrWarrant:Boolean;
        private const _STATUS_OBJ:Object;
        public var date:Date;
        public var inited:Boolean;
        public var isStime:Boolean;
        public var isStopDay:Boolean = false;
        public var totalAmount:Number = 0;
        private var _cfg:Config;
        public var today:String;
        public var price:Number;
        public var time:String;
        public var isDateChange:Boolean;
        public var open:Number;
        private var min:uint;
        public var low:Number;
        public var amount:Number = 0;
        public var index:uint;
        public var statusStr:String;
        private var _util:DataTool;
        public var sell:Number;
        private var hour:uint;
        public var ppp:uint = 2;
        public var status:String;
        public var hqTotalAmount:Number = 0;
        public var isPre5Min:Boolean;
        public var totalVolume:Number = 0;
        public var needUpdate:Boolean;

        public function HQ(param1:String, param2:String)
        {
            this._STATUS_OBJ = {00:"", 01:"临时停牌", 02:"停牌", 03:"停牌", 04:"临时停牌", 05:"临时停牌", 07:"暂停"};
            this._util = DataTool.getInstance();
            this._cfg = Config.getInstance();
            this.symbol = param1;
            this._isShIndexOrWarrant = /^(sh000|sh580)\d*/.test(param1);
            if (/^(sh(90|58))|(sz20)|(sz1[56])\d*/.test(param1))
            {
                this.ppp = 3;
            }
            var _loc_3:* = param2.split(",");
            if (_loc_3 && _loc_3.length > 32)
            {
                this.name = _loc_3[0];
            }
            this.update(param2);
            return;
        }// end function

        public function setBufData(param1:Object) : void
        {
            if (param1 == null)
            {
                return;
            }
            this._bufData = param1;
            return;
        }// end function

        private function setTimeAbout() : void
        {
            var _loc_1:* = this.time.split(":");
            this.hour = uint(_loc_1[0]);
            this.min = uint(_loc_1[1]);
            this.isStime = Boolean(this.hour == 9 && this.min < 30);
            this.isPre25Min = this.hour == 9 && this.min < 25;
            this.isPre5Min = this.hour == 9 && this.min > 24 && this.min < 30;
            this.needUpdate = true;
            if (this.hour == 9 && this.min < 30 && this.min >= 25)
            {
                this.index = 0;
            }
            else if (this.hour == 9 && this.min >= 30)
            {
                this.index = this.min - 30;
            }
            else if (this.hour == 10)
            {
                this.index = this.min + 30;
            }
            else if (this.hour == 11 && this.min <= 30)
            {
                this.index = this.min + 90;
            }
            else if (this.hour == 13)
            {
                this.index = this.min + 121;
            }
            else if (this.hour == 14)
            {
                this.index = this.min + 181;
            }
            else if (this.hour == 15 && this.min == 0)
            {
                this.index = this.min + 241;
            }
            else
            {
                this.needUpdate = false;
            }
            if (this.needUpdate && this.hour == 9 && this.min == 30)
            {
                this.needUpdate = false;
            }
            return;
        }// end function

        public function update(param1:String) : void
        {
            if (param1 == null || param1.length < 31)
            {
                return;
            }
            var _loc_2:* = param1.split(",");
            this.prevclose = Number(_loc_2[2]) || 1;
            this.open = Number(_loc_2[1]) || this.prevclose;
            this.price = Number(_loc_2[3]) || this.prevclose;
            this.high = Number(_loc_2[4]) || this.prevclose;
            this.low = Number(_loc_2[5]) || this.prevclose;
            this.buy = Number(_loc_2[6]);
            this.sell = Number(_loc_2[7]);
            this.totalVolume = Number(_loc_2[8]) || 0;
            var _loc_3:* = Number(_loc_2[9]);
            this.hqTotalAmount = Number(_loc_2[9]);
            this.totalAmount = _loc_3;
            this.time = String(_loc_2[31]).substr(0, 5);
            this.today = String(_loc_2[30]);
            this.status = String(_loc_2[32]);
            this.isStopDay = this.status == "02" || this.status == "03";
            this.statusStr = this._STATUS_OBJ[this.status] || "";
            this.setDateAbout();
            this.setTimeAbout();
            if (this._cfg.isBond)
            {
                this.totalVolume = this.totalVolume / 10;
            }
            else if (!this._isShIndexOrWarrant)
            {
                this.totalVolume = this.totalVolume / 100;
            }
            if (this._bufData)
            {
                if (!this.inited)
                {
                    this.inited = true;
                    this.volume = 0;
                    this.avg_price = this._bufData.totalAmount / this._bufData.totalVolume || this.price;
                    this.totalAmount = this.totalVolume * this.avg_price;
                }
                else
                {
                    this.volume = this.totalVolume - this._bufData.totalVolume || 0;
                    this.amount = this.volume * this.price;
                    this.totalAmount = this.amount + this._bufData.totalAmount;
                    this.avg_price = this.totalAmount / this.totalVolume || this.price;
                }
                this._bufData.totalVolume = this.totalVolume;
                this._bufData.totalAmount = this.totalAmount;
            }
            return;
        }// end function

        private function setDateAbout() : void
        {
            var _loc_5:Boolean = false;
            var _loc_6:Date = null;
            this.isDateChange = false;
            var _loc_1:* = this.today.split("-");
            var _loc_2:* = uint(_loc_1[0]);
            var _loc_3:* = uint((_loc_1[1] - 1));
            var _loc_4:* = uint(_loc_1[2]);
            if (this.date == null)
            {
                this.date = new Date(_loc_2, _loc_3, _loc_4);
            }
            else
            {
                _loc_5 = Boolean(this.date.fullYear == _loc_2 ? (this.date.month == _loc_3 ? (this.date.date == _loc_4) : (false)) : (false));
                if (!_loc_5)
                {
                    _loc_6 = new Date(_loc_2, _loc_3, _loc_4);
                    this.isDateChange = _loc_6 > this.date;
                    if (this.isDateChange)
                    {
                        this.date = this._util.cloneDate(_loc_6);
                    }
                }
            }
            return;
        }// end function

    }
}
