package com.ui
{
    import com.sina.finance.data.*;
    import flash.display.*;
    import flash.events.*;
    import flash.net.*;
    import flash.utils.*;
    import hsuan.*;
    import mx.utils.*;

    public class ShareTo extends Object
    {
        private var _dataTool:DataTool;
        private var _view:String;
        private var _isSharing:Boolean = false;
        private var _type:String = "";
        private var _to:String;
        private var _cfg:Config;
        private var _name:String = "";
        private var _symbol:String = "sh000001";
        public static const RENREN:String = "renren";
        public static const BAIDU_BLOG:String = "baidublog";
        public static const QQ_WEIBO:String = "qqweibo";
        public static const SOHU_WEIBO:String = "sohuweibo";
        public static const KAIXIN:String = "kaixin";
        public static const SINA_WEIBO:String = "weibo";
        public static const QQ_ZONE:String = "qzone";
        public static const NTES_WEIBO:String = "ntesweibo";
        private static var _:ShareTo;

        public function ShareTo()
        {
            this._cfg = Config.getInstance();
            this._dataTool = DataTool.getInstance();
            return;
        }// end function

        private function sendToWeibo(param1:String) : void
        {
            var _loc_2:String = null;
            var _loc_7:String = null;
            this._isSharing = false;
            var _loc_3:Boolean = true;
            var _loc_4:String = "url";
            var _loc_5:String = "pic";
            switch(this._to)
            {
                default:
                {
                    _loc_2 = "http://service.weibo.com/share/share.php?source=bookmark&title=";
                    break;
                }
                case SOHU_WEIBO:
                {
                    _loc_2 = "http://v.t.qq.com/share/share.php?title=";
                    break;
                }
                case KAIXIN:
                {
                    _loc_2 = "http://t.sohu.com/third/post.jsp?content=utf-8&title=";
                    break;
                }
                case QQ_ZONE:
                {
                    _loc_2 = "http://www.kaixin001.com/rest/records.php?starid=0&aid=0&style=11&content=";
                    break;
                }
                case NTES_WEIBO:
                {
                    _loc_2 = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title=";
                    _loc_5 = "pics";
                    break;
                }
                case BAIDU_BLOG:
                {
                    _loc_2 = "http://t.163.com/article/user/checkLogin.do?info=";
                    _loc_5 = "images";
                    _loc_4 = "link";
                    break;
                }
                case RENREN:
                {
                    _loc_2 = "http://apps.hi.baidu.com/share/?title=";
                    _loc_3 = false;
                    break;
                }
                case :
                {
                    _loc_2 = "http://share.renren.com/share/buttonshare.do?title=";
                    _loc_4 = "link";
                    break;
                    break;
                }
            }
            var _loc_6:* = "#" + this._name + "#(#" + this._symbol + "#)行情走势_" + this._type + "_新浪财经";
            _loc_2 = _loc_2 + encodeURIComponent(_loc_6);
            _loc_2 = _loc_2 + ("&" + _loc_4 + "=" + this._cfg.mbPopUrl);
            if (this._view && StringUtil.trim(this._view) != "")
            {
                _loc_7 = this._cfg.mbPopUrl.search(/%3F/i) > 0 ? ("&") : ("?");
                _loc_7 = _loc_7 + ("view=" + this._view);
                _loc_2 = _loc_2 + encodeURIComponent(_loc_7);
            }
            if (_loc_3)
            {
                _loc_2 = _loc_2 + ("&" + _loc_5 + "=" + encodeURIComponent(param1));
            }
            this.toUrl(_loc_2);
            return;
        }// end function

        public function setTypeId(param1:Boolean, param2:uint, param3:Boolean = false) : void
        {
            if (param1)
            {
                if (param2 == 1)
                {
                    this._type = "1日分时";
                }
                else if (param2 == 5)
                {
                    this._type = (param3 ? ("1日") : ("5日")) + "分时";
                }
                else if (param2 == 3)
                {
                    this._type = "年收盘线";
                }
                else
                {
                    this._type = "";
                }
            }
            else if (param2 == 5)
            {
                this._type = "5分K线";
            }
            else if (param2 == 15)
            {
                this._type = "15分K线";
            }
            else if (param2 == 30)
            {
                this._type = "30分K线";
            }
            else if (param2 == 60)
            {
                this._type = "60分K线";
            }
            else if (param2 == 24)
            {
                this._type = "日K线";
            }
            else if (param2 == 168)
            {
                this._type = "周K线";
            }
            else if (param2 == 720)
            {
                this._type = "月K线";
            }
            else
            {
                this._type = "";
            }
            return;
        }// end function

        public function send(param1:Stage, param2:String, param3:String, param4:String = null, param5:String = null) : void
        {
            this.postInit(param2, param3, param4, param5);
            var _loc_6:* = new BitmapData(this._cfg.viewW, this._cfg.viewH + (this._cfg.paramArr[1] == true ? (0) : (20)));
            new BitmapData(this._cfg.viewW, this._cfg.viewH + (this._cfg.paramArr[1] == true ? (0) : (20))).draw(param1);
            this.postScreenGrab(_loc_6);
            return;
        }// end function

        private function postInit(param1:String, param2:String, param3:String = null, param4:String = null) : void
        {
            if (this._isSharing)
            {
                return;
            }
            this._isSharing = true;
            this.toUrl("about:blank");
            if (this._cfg.floater)
            {
                this._cfg.floater.visible = false;
            }
            this._name = param1;
            this._symbol = param2;
            this._to = param3 ? (param3) : (SINA_WEIBO);
            this._view = param4 ? (param4) : ("");
            return;
        }// end function

        private function postScreenGrab(param1:BitmapData) : void
        {
            var _loc_2:* = PNGEncoder.encode(param1);
            var _loc_3:* = new URLRequestHeader("Content-type", "application/octet-stream");
            var _loc_4:* = new URLRequest("http://stock.finance.sina.com.cn/misc/userapi/vCNStock_Pic4Weibo.php?symbol=" + this._symbol);
            new URLRequest("http://stock.finance.sina.com.cn/misc/userapi/vCNStock_Pic4Weibo.php?symbol=" + this._symbol).requestHeaders.push(_loc_3);
            _loc_4.method = URLRequestMethod.POST;
            _loc_4.data = _loc_2;
            var _loc_5:* = new URLLoader();
            new URLLoader().addEventListener(Event.COMPLETE, this.onWeiboComplete);
            _loc_5.addEventListener(IOErrorEvent.IO_ERROR, this.onCaptureErr);
            _loc_5.load(_loc_4);
            this._cfg.sendStatistic("common.html?type=" + this._to);
            return;
        }// end function

        private function onWeiboComplete(event:Event) : void
        {
            event.target.removeEventListener(IOErrorEvent.IO_ERROR, this.onCaptureErr);
            event.target.removeEventListener(Event.COMPLETE, this.onWeiboComplete);
            var _loc_2:* = event.target.data;
            this.sendToWeibo(_loc_2);
            return;
        }// end function

        private function toUrl(param1:String, param2:String = "flashStockWeiboFenster") : void
        {
            navigateToURL(new URLRequest(param1), param2);
            return;
        }// end function

        private function onCaptureErr(event:IOErrorEvent) : void
        {
            event.target.removeEventListener(IOErrorEvent.IO_ERROR, this.onCaptureErr);
            event.target.removeEventListener(Event.COMPLETE, this.onWeiboComplete);
            this._isSharing = false;
            return;
        }// end function

        public static function getInstance() : ShareTo
        {
            if (!_)
            {
                _ = new ShareTo;
            }
            return _;
        }// end function

    }
}
